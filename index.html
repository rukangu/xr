<script>
  AFRAME.registerComponent('pinch-grab', {
    init: function () {
      this.grabbedEl = null;
      
      // DEBUG: Create a small red sphere to show where your hand "center" is
      this.debugHand = document.createElement('a-sphere');
      this.debugHand.setAttribute('radius', '0.05'); // 5cm radius
      this.debugHand.setAttribute('color', 'red');
      this.debugHand.setAttribute('opacity', '0.5');
      this.el.appendChild(this.debugHand);

      this.el.addEventListener('pinchstarted', this.onPinch.bind(this));
      this.el.addEventListener('pinchended', this.onRelease.bind(this));
    },

    onPinch: function (evt) {
      const els = document.querySelectorAll('.interactive');
      let closestEl = null;
      // INCREASED DISTANCE: Since dogs are huge, we need a bigger reach (0.8 meters)
      let minDist = 0.8; 

      const handWorldPos = new THREE.Vector3();
      this.el.object3D.getWorldPosition(handWorldPos);

      console.log("--- PINCH STARTED ---");
      console.log("Hand Position:", handWorldPos);

      els.forEach(el => {
        const elWorldPos = new THREE.Vector3();
        el.object3D.getWorldPosition(elWorldPos);
        
        const dist = handWorldPos.distanceTo(elWorldPos);
        console.log(`Checking ${el.id || 'object'}: Distance = ${dist.toFixed(2)}m`);

        // DEBUG: Visualize the object's pivot point
        if (!el.querySelector('.debug-pivot')) {
           const pivot = document.createElement('a-sphere');
           pivot.setAttribute('radius', '0.1');
           pivot.setAttribute('color', 'green');
           pivot.setAttribute('material', 'wireframe: true');
           pivot.setAttribute('class', 'debug-pivot');
           el.appendChild(pivot);
        }

        if (dist < minDist) {
          minDist = dist;
          closestEl = el;
        }
      });

      if (closestEl) {
        console.log("GRAB SUCCESS: " + closestEl.id);
        this.grabbedEl = closestEl;
        this.el.object3D.attach(this.grabbedEl.object3D);
        this.debugHand.setAttribute('color', 'green'); // Turn hand green on grab
      } else {
        console.log("GRAB FAILED: Nothing close enough.");
        this.debugHand.setAttribute('color', 'red');
      }
    },

    onRelease: function () {
      if (this.grabbedEl) {
        this.el.sceneEl.object3D.attach(this.grabbedEl.object3D);
        this.grabbedEl = null;
        this.debugHand.setAttribute('color', 'red'); // Reset color
      }
    }
  });
</script>